// This file was generated by SquareLine Studio
// SquareLine Studio version: SquareLine Studio 1.3.4
// LVGL version: 8.3.6
// Project name: SquareLine_Project

#include "ui.h"
#include "totp-map.h"
#include "esp_log.h"

static void timer_callback(lv_timer_t *timer) {
    LV_LOG_USER("timer_callback called.");  //this line is added to log message
    lv_obj_t *screen = (lv_obj_t*)timer->user_data;
    lv_obj_t *child;

    // Get the first child of the screen
    child = lv_obj_get_child(screen, NULL);

    while (child) {
        if (lv_obj_check_type(child, &lv_label_class)) {
            // your code to do something with the label
            lv_event_send(child, LV_EVENT_REFRESH, NULL);
        }

        // Get the next child
        child = lv_obj_get_child(screen, child);
    }
}

void on_screen_loaded(lv_event_t *e) {
    LV_LOG_USER("on_aws_screen_loaded called.");  //this line is added to log message
    static lv_timer_t *timer; 
    if (timer == NULL) {
        timer = lv_timer_create(timer_callback, 30000, lv_event_get_target(e));
    }
}

void on_aws_refresh(lv_event_t * e){
    LV_LOG_USER("on_aws_refresh called.");  //this line is added to log message
    lv_obj_t * label = lv_event_get_target(e);
    char * totp = get_totp("aws");
    if (totp){
        lv_label_set_text(label, totp);
    }
}